<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>{{ if .Title }}{{ .Title }} - {{ end }}{{ .Site.Title }}</title>

        <!-- Open Graph / Facebook -->
        <meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}" />
        <meta property="og:url" content="{{ .Permalink }}" />
        <meta
            property="og:title"
            content="{{ if .Title }}{{ .Title }}{{ else }}{{ .Site.Title }}{{ end }}"
        />
        <meta
            property="og:description"
            content="{{ with .Description }}{{ . }}{{ else }}{{ if .IsPage }}{{ .Summary }}{{ else }}{{ .Site.Params.description }}{{ end }}{{ end }}"
        />
        <meta property="og:site_name" content="{{ .Site.Title }}" />
        {{ with .Params.image }}
        <meta property="og:image" content="{{ . | absURL }}" />
        {{ end }}

        <!-- Twitter -->
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:url" content="{{ .Permalink }}" />
        <meta
            name="twitter:title"
            content="{{ if .Title }}{{ .Title }}{{ else }}{{ .Site.Title }}{{ end }}"
        />
        <meta
            name="twitter:description"
            content="{{ with .Description }}{{ . }}{{ else }}{{ if .IsPage }}{{ .Summary }}{{ else }}{{ .Site.Params.description }}{{ end }}{{ end }}"
        />
        {{ with .Params.image }}
        <meta name="twitter:image" content="{{ . | absURL }}" />
        {{ end }} {{ if .Params.math }}
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
        />
        <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
        <script
            defer
            src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
        ></script>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                renderMathInElement(document.body, {
                    delimiters: [
                        { left: "$$", right: "$$", display: true },
                        { left: "$", right: "$", display: false },
                        { left: "\\(", right: "\\)", display: false },
                        { left: "\\[", right: "\\]", display: true },
                    ],
                    throwOnError: false,
                });
            });
        </script>
        {{ end }}
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400&display=swap"
            rel="stylesheet"
        />
        <link
            href="https://fonts.googleapis.com/css2?family=Averia+Serif+Libre:wght@300;400;700&family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&display=swap"
            rel="stylesheet"
        />
        <link rel="stylesheet" href="/css/theme.css" />
        <link rel="stylesheet" href="/css/general.css" />
        <link rel="stylesheet" href="/css/tags.css" />
        <link rel="stylesheet" href="/css/sidenotes.css" />
        <link rel="stylesheet" href="/css/math.css" />
        <link rel="stylesheet" media="print" href="/css/printspecific.css" />
        <script>
            // Initialize theme before page renders to avoid flash
            (function () {
                const savedTheme = localStorage.getItem("theme");
                const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
                const theme = savedTheme || (prefersDark ? "dark" : "light");
                document.documentElement.setAttribute("data-theme", theme);
            })();
        </script>
    </head>
    <body>
        <header class="site-header">
            <div class="header-left">
                <h1 class="site-title"><a href="/">{{ .Site.Title }}</a></h1>
                <nav>
                    <a href="/posts/">Blog</a>
                    <a href="/thoughts/">Thoughts</a>
                    <a href="/reading/">Reading</a>
                    <a href="/pages/">Pages</a>
                    <a href="/tags/">Tags</a>
                </nav>
            </div>
            <div class="header-right">
                <div class="rss-dropdown">
                    <button class="icon-button" id="rss-toggle" aria-label="RSS Feeds" title="RSS Feeds">
                        <img src="/icons/rss.svg" alt="RSS" />
                    </button>
                    <div class="rss-dropdown-menu" id="rss-menu">
                        <a href="/index.xml">Blog Posts</a>
                        <a href="/reading/index.xml">Reading List</a>
                    </div>
                </div>
                <button class="icon-button" id="theme-toggle" aria-label="Toggle theme">
                    <img class="theme-icon sun-icon" src="/icons/sun.svg" alt="Light mode" />
                    <img class="theme-icon moon-icon" src="/icons/moon.svg" alt="Dark mode" />
                </button>
            </div>
        </header>
        <main>{{ block "main" . }}{{ end }}</main>
        <script>
            // Theme toggle functionality
            const themeToggle = document.getElementById("theme-toggle");

            themeToggle.addEventListener("click", () => {
                const current = document.documentElement.getAttribute("data-theme");
                const next = current === "dark" ? "light" : "dark";

                document.documentElement.setAttribute("data-theme", next);
                localStorage.setItem("theme", next);
            });

            // RSS dropdown functionality
            const rssToggle = document.getElementById("rss-toggle");
            const rssMenu = document.getElementById("rss-menu");

            rssToggle.addEventListener("click", (e) => {
                e.stopPropagation();
                rssMenu.classList.toggle("show");
            });

            document.addEventListener("click", () => {
                rssMenu.classList.remove("show");
            });
        </script>
    </body>
</html>
